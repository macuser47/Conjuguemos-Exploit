//chrome.storage.local.clear(function(){/*alert("*explosion sounds*");*/});

chrome.storage.local.get("enabled", callbck);

var toggle;

function callbck(items) {
  //alert("things should happen now.");
  if(items["enabled"]) {
    //alert("ERN!");
    chrome.browserAction.setIcon({path: "gfx/on.png"})
    toggle = true;
  }
  else {
    //alert("ERF!");
    chrome.browserAction.setIcon({path: "gfx/off.png"});
    toggle = false;
  }
}

chrome.browserAction.onClicked.addListener(function(tab) {
  toggle = !toggle;
  if(toggle){
    chrome.browserAction.setIcon({path: "gfx/on.png"});
    chrome.storage.local.set({"enabled": true}, function(){alert("You have activated the conjuguemos exploit. The program will immediately generate and submit 100%. Don't forget to turn the exploit off when you're done. \n\n Cheers, \n macuser47");});
  }
  else{
    chrome.browserAction.setIcon({path: "gfx/off.png"});
    chrome.storage.local.clear(function(){/*alert("*explosion sounds*");*/});
  }
});